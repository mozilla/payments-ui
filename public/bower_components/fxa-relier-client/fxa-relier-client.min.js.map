{"version":3,"file":"fxa-relier-client.min.js","sources":["components/almond/almond.js","components/p-promise/p.js","client/lib/function.js","client/lib/object.js","client/lib/options.js","client/lib/constants.js","client/lib/url.js","client/auth/base/api.js","client/auth/lightbox/lightbox.js","client/auth/lightbox/iframe_channel.js","client/auth/lightbox/api.js","client/auth/redirect/api.js","client/auth/api.js","components/micrajax/micrajax.js","client/lib/xhr.js","client/token/api.js","client/profile/api.js","client/FxaRelierClient.js"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license almond 0.3.0 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.\n * Available via the MIT or new BSD license.\n * see: http://github.com/jrburke/almond for details\n */\n//Going sloppy to avoid 'use strict' string cost, but strict practices should\n//be followed.\n/*jslint sloppy: true */\n/*global setTimeout: false */\n\nvar requirejs, require, define;\n(function (undef) {\n    var main, req, makeMap, handlers,\n        defined = {},\n        waiting = {},\n        config = {},\n        defining = {},\n        hasOwn = Object.prototype.hasOwnProperty,\n        aps = [].slice,\n        jsSuffixRegExp = /\\.js$/;\n\n    function hasProp(obj, prop) {\n        return hasOwn.call(obj, prop);\n    }\n\n    /**\n     * Given a relative module name, like ./something, normalize it to\n     * a real name that can be mapped to a path.\n     * @param {String} name the relative name\n     * @param {String} baseName a real name that the name arg is relative\n     * to.\n     * @returns {String} normalized name\n     */\n    function normalize(name, baseName) {\n        var nameParts, nameSegment, mapValue, foundMap, lastIndex,\n            foundI, foundStarMap, starI, i, j, part,\n            baseParts = baseName && baseName.split(\"/\"),\n            map = config.map,\n            starMap = (map && map['*']) || {};\n\n        //Adjust any relative paths.\n        if (name && name.charAt(0) === \".\") {\n            //If have a base name, try to normalize against it,\n            //otherwise, assume it is a top-level require that will\n            //be relative to baseUrl in the end.\n            if (baseName) {\n                //Convert baseName to array, and lop off the last part,\n                //so that . matches that \"directory\" and not name of the baseName's\n                //module. For instance, baseName of \"one/two/three\", maps to\n                //\"one/two/three.js\", but we want the directory, \"one/two\" for\n                //this normalization.\n                baseParts = baseParts.slice(0, baseParts.length - 1);\n                name = name.split('/');\n                lastIndex = name.length - 1;\n\n                // Node .js allowance:\n                if (config.nodeIdCompat && jsSuffixRegExp.test(name[lastIndex])) {\n                    name[lastIndex] = name[lastIndex].replace(jsSuffixRegExp, '');\n                }\n\n                name = baseParts.concat(name);\n\n                //start trimDots\n                for (i = 0; i < name.length; i += 1) {\n                    part = name[i];\n                    if (part === \".\") {\n                        name.splice(i, 1);\n                        i -= 1;\n                    } else if (part === \"..\") {\n                        if (i === 1 && (name[2] === '..' || name[0] === '..')) {\n                            //End of the line. Keep at least one non-dot\n                            //path segment at the front so it can be mapped\n                            //correctly to disk. Otherwise, there is likely\n                            //no path mapping for a path starting with '..'.\n                            //This can still fail, but catches the most reasonable\n                            //uses of ..\n                            break;\n                        } else if (i > 0) {\n                            name.splice(i - 1, 2);\n                            i -= 2;\n                        }\n                    }\n                }\n                //end trimDots\n\n                name = name.join(\"/\");\n            } else if (name.indexOf('./') === 0) {\n                // No baseName, so this is ID is resolved relative\n                // to baseUrl, pull off the leading dot.\n                name = name.substring(2);\n            }\n        }\n\n        //Apply map config if available.\n        if ((baseParts || starMap) && map) {\n            nameParts = name.split('/');\n\n            for (i = nameParts.length; i > 0; i -= 1) {\n                nameSegment = nameParts.slice(0, i).join(\"/\");\n\n                if (baseParts) {\n                    //Find the longest baseName segment match in the config.\n                    //So, do joins on the biggest to smallest lengths of baseParts.\n                    for (j = baseParts.length; j > 0; j -= 1) {\n                        mapValue = map[baseParts.slice(0, j).join('/')];\n\n                        //baseName segment has  config, find if it has one for\n                        //this name.\n                        if (mapValue) {\n                            mapValue = mapValue[nameSegment];\n                            if (mapValue) {\n                                //Match, update name to the new value.\n                                foundMap = mapValue;\n                                foundI = i;\n                                break;\n                            }\n                        }\n                    }\n                }\n\n                if (foundMap) {\n                    break;\n                }\n\n                //Check for a star map match, but just hold on to it,\n                //if there is a shorter segment match later in a matching\n                //config, then favor over this star map.\n                if (!foundStarMap && starMap && starMap[nameSegment]) {\n                    foundStarMap = starMap[nameSegment];\n                    starI = i;\n                }\n            }\n\n            if (!foundMap && foundStarMap) {\n                foundMap = foundStarMap;\n                foundI = starI;\n            }\n\n            if (foundMap) {\n                nameParts.splice(0, foundI, foundMap);\n                name = nameParts.join('/');\n            }\n        }\n\n        return name;\n    }\n\n    function makeRequire(relName, forceSync) {\n        return function () {\n            //A version of a require function that passes a moduleName\n            //value for items that may need to\n            //look up paths relative to the moduleName\n            var args = aps.call(arguments, 0);\n\n            //If first arg is not require('string'), and there is only\n            //one arg, it is the array form without a callback. Insert\n            //a null so that the following concat is correct.\n            if (typeof args[0] !== 'string' && args.length === 1) {\n                args.push(null);\n            }\n            return req.apply(undef, args.concat([relName, forceSync]));\n        };\n    }\n\n    function makeNormalize(relName) {\n        return function (name) {\n            return normalize(name, relName);\n        };\n    }\n\n    function makeLoad(depName) {\n        return function (value) {\n            defined[depName] = value;\n        };\n    }\n\n    function callDep(name) {\n        if (hasProp(waiting, name)) {\n            var args = waiting[name];\n            delete waiting[name];\n            defining[name] = true;\n            main.apply(undef, args);\n        }\n\n        if (!hasProp(defined, name) && !hasProp(defining, name)) {\n            throw new Error('No ' + name);\n        }\n        return defined[name];\n    }\n\n    //Turns a plugin!resource to [plugin, resource]\n    //with the plugin being undefined if the name\n    //did not have a plugin prefix.\n    function splitPrefix(name) {\n        var prefix,\n            index = name ? name.indexOf('!') : -1;\n        if (index > -1) {\n            prefix = name.substring(0, index);\n            name = name.substring(index + 1, name.length);\n        }\n        return [prefix, name];\n    }\n\n    /**\n     * Makes a name map, normalizing the name, and using a plugin\n     * for normalization if necessary. Grabs a ref to plugin\n     * too, as an optimization.\n     */\n    makeMap = function (name, relName) {\n        var plugin,\n            parts = splitPrefix(name),\n            prefix = parts[0];\n\n        name = parts[1];\n\n        if (prefix) {\n            prefix = normalize(prefix, relName);\n            plugin = callDep(prefix);\n        }\n\n        //Normalize according\n        if (prefix) {\n            if (plugin && plugin.normalize) {\n                name = plugin.normalize(name, makeNormalize(relName));\n            } else {\n                name = normalize(name, relName);\n            }\n        } else {\n            name = normalize(name, relName);\n            parts = splitPrefix(name);\n            prefix = parts[0];\n            name = parts[1];\n            if (prefix) {\n                plugin = callDep(prefix);\n            }\n        }\n\n        //Using ridiculous property names for space reasons\n        return {\n            f: prefix ? prefix + '!' + name : name, //fullName\n            n: name,\n            pr: prefix,\n            p: plugin\n        };\n    };\n\n    function makeConfig(name) {\n        return function () {\n            return (config && config.config && config.config[name]) || {};\n        };\n    }\n\n    handlers = {\n        require: function (name) {\n            return makeRequire(name);\n        },\n        exports: function (name) {\n            var e = defined[name];\n            if (typeof e !== 'undefined') {\n                return e;\n            } else {\n                return (defined[name] = {});\n            }\n        },\n        module: function (name) {\n            return {\n                id: name,\n                uri: '',\n                exports: defined[name],\n                config: makeConfig(name)\n            };\n        }\n    };\n\n    main = function (name, deps, callback, relName) {\n        var cjsModule, depName, ret, map, i,\n            args = [],\n            callbackType = typeof callback,\n            usingExports;\n\n        //Use name if no relName\n        relName = relName || name;\n\n        //Call the callback to define the module, if necessary.\n        if (callbackType === 'undefined' || callbackType === 'function') {\n            //Pull out the defined dependencies and pass the ordered\n            //values to the callback.\n            //Default to [require, exports, module] if no deps\n            deps = !deps.length && callback.length ? ['require', 'exports', 'module'] : deps;\n            for (i = 0; i < deps.length; i += 1) {\n                map = makeMap(deps[i], relName);\n                depName = map.f;\n\n                //Fast path CommonJS standard dependencies.\n                if (depName === \"require\") {\n                    args[i] = handlers.require(name);\n                } else if (depName === \"exports\") {\n                    //CommonJS module spec 1.1\n                    args[i] = handlers.exports(name);\n                    usingExports = true;\n                } else if (depName === \"module\") {\n                    //CommonJS module spec 1.1\n                    cjsModule = args[i] = handlers.module(name);\n                } else if (hasProp(defined, depName) ||\n                           hasProp(waiting, depName) ||\n                           hasProp(defining, depName)) {\n                    args[i] = callDep(depName);\n                } else if (map.p) {\n                    map.p.load(map.n, makeRequire(relName, true), makeLoad(depName), {});\n                    args[i] = defined[depName];\n                } else {\n                    throw new Error(name + ' missing ' + depName);\n                }\n            }\n\n            ret = callback ? callback.apply(defined[name], args) : undefined;\n\n            if (name) {\n                //If setting exports via \"module\" is in play,\n                //favor that over return value and exports. After that,\n                //favor a non-undefined return value over exports use.\n                if (cjsModule && cjsModule.exports !== undef &&\n                        cjsModule.exports !== defined[name]) {\n                    defined[name] = cjsModule.exports;\n                } else if (ret !== undef || !usingExports) {\n                    //Use the return value from the function.\n                    defined[name] = ret;\n                }\n            }\n        } else if (name) {\n            //May just be an object definition for the module. Only\n            //worry about defining if have a module name.\n            defined[name] = callback;\n        }\n    };\n\n    requirejs = require = req = function (deps, callback, relName, forceSync, alt) {\n        if (typeof deps === \"string\") {\n            if (handlers[deps]) {\n                //callback in this case is really relName\n                return handlers[deps](callback);\n            }\n            //Just return the module wanted. In this scenario, the\n            //deps arg is the module name, and second arg (if passed)\n            //is just the relName.\n            //Normalize module name, if it contains . or ..\n            return callDep(makeMap(deps, callback).f);\n        } else if (!deps.splice) {\n            //deps is a config object, not an array.\n            config = deps;\n            if (config.deps) {\n                req(config.deps, config.callback);\n            }\n            if (!callback) {\n                return;\n            }\n\n            if (callback.splice) {\n                //callback is an array, which means it is a dependency list.\n                //Adjust args if there are dependencies\n                deps = callback;\n                callback = relName;\n                relName = null;\n            } else {\n                deps = undef;\n            }\n        }\n\n        //Support require(['a'])\n        callback = callback || function () {};\n\n        //If relName is a function, it is an errback handler,\n        //so remove it.\n        if (typeof relName === 'function') {\n            relName = forceSync;\n            forceSync = alt;\n        }\n\n        //Simulate async callback;\n        if (forceSync) {\n            main(undef, deps, callback, relName);\n        } else {\n            //Using a non-zero value because of concern for what old browsers\n            //do, and latest browsers \"upgrade\" to 4 if lower value is used:\n            //http://www.whatwg.org/specs/web-apps/current-work/multipage/timers.html#dom-windowtimers-settimeout:\n            //If want a value immediately, use require('id') instead -- something\n            //that works in almond on the global level, but not guaranteed and\n            //unlikely to work in other AMD implementations.\n            setTimeout(function () {\n                main(undef, deps, callback, relName);\n            }, 4);\n        }\n\n        return req;\n    };\n\n    /**\n     * Just drops the config on the floor, but returns req in case\n     * the config return value is used.\n     */\n    req.config = function (cfg) {\n        return req(cfg);\n    };\n\n    /**\n     * Expose module registry for debugging and tooling\n     */\n    requirejs._defined = defined;\n\n    define = function (name, deps, callback) {\n\n        //This module may not have dependencies\n        if (!deps.splice) {\n            //deps is not an array, so probably means\n            //an object literal or factory function for\n            //the value. Adjust args.\n            callback = deps;\n            deps = [];\n        }\n\n        if (!hasProp(defined, name) && !hasProp(waiting, name)) {\n            waiting[name] = [name, deps, callback];\n        }\n    };\n\n    define.amd = {\n        jQuery: true\n    };\n}());\n\ndefine(\"components/almond/almond\", function(){});\n\n","/*!\r\n * Copyright 2013 Robert KatiÄ‡\r\n * Released under the MIT license\r\n * https://github.com/rkatic/p/blob/master/LICENSE\r\n *\r\n * High-priority-tasks code-portion based on https://github.com/kriskowal/asap\r\n * Long-Stack-Support code-portion based on https://github.com/kriskowal/q\r\n */\r\n;(function( factory ){\r\n\t// CommonJS\r\n\tif ( typeof module !== \"undefined\" && module && module.exports ) {\r\n\t\tmodule.exports = factory();\r\n\r\n\t// RequireJS\r\n\t} else if ( typeof define === \"function\" && define.amd ) {\r\n\t\tdefine( 'p-promise',factory );\r\n\r\n\t// global\r\n\t} else {\r\n\t\tP = factory();\r\n\t}\r\n})(function() {\r\n\t\"use strict\";\r\n\r\n\tvar withStack = withStackThrowing,\r\n\t\tpStartingLine = captureLine(),\r\n\t\tpFileName,\r\n\t\tcurrentTrace = null;\r\n\r\n\tfunction withStackThrowing( error ) {\r\n\t\tif ( !error.stack ) {\r\n\t\t\ttry {\r\n\t\t\t\tthrow error;\r\n\t\t\t} catch ( e ) {}\r\n\t\t}\r\n\t\treturn error;\r\n\t}\r\n\r\n\tif ( new Error().stack ) {\r\n\t\twithStack = function( error ) {\r\n\t\t\treturn error;\r\n\t\t};\r\n\t}\r\n\r\n\tfunction getTrace() {\r\n\t\tvar stack = withStack( new Error() ).stack;\r\n\t\tif ( !stack ) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\tvar stacks = [ filterStackString( stack, 1 ) ];\r\n\r\n\t\tif ( currentTrace ) {\r\n\t\t\tstacks = stacks.concat( currentTrace );\r\n\r\n\t\t\tif ( stacks.length === 128 ) {\r\n\t\t\t\tstacks.pop();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn stacks;\r\n\t}\r\n\r\n\tfunction getFileNameAndLineNumber( stackLine ) {\r\n\t\tvar m =\r\n\t\t\t/at .+ \\((.+):(\\d+):(?:\\d+)\\)$/.exec( stackLine ) ||\r\n\t\t\t/at ([^ ]+):(\\d+):(?:\\d+)$/.exec( stackLine ) ||\r\n\t\t\t/@(.+):(\\d+):(?:\\d+)$/.exec( stackLine );\r\n\r\n\t\treturn m ? { fileName: m[1], lineNumber: Number(m[2]) } : null;\r\n\t}\r\n\r\n\tfunction captureLine() {\r\n\t\tvar stack = withStack( new Error() ).stack;\r\n\t\tif ( !stack ) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tvar lines = stack.split(\"\\n\");\r\n\t\tvar firstLine = lines[0].indexOf(\"@\") > 0 ? lines[1] : lines[2];\r\n\t\tvar pos = getFileNameAndLineNumber( firstLine );\r\n\t\tif ( !pos ) {\r\n\t\t\treturn 0;\r\n\t\t}\r\n\r\n\t\tpFileName = pos.fileName;\r\n\t\treturn pos.lineNumber;\r\n\t}\r\n\r\n\tfunction filterStackString( stack, ignoreFirstLines ) {\r\n\t\tvar lines = stack.split(\"\\n\");\r\n\t\tvar goodLines = [];\r\n\r\n\t\tfor ( var i = ignoreFirstLines|0, l = lines.length; i < l; ++i ) {\r\n\t\t\tvar line = lines[i];\r\n\r\n\t\t\tif ( line && !isNodeFrame(line) && !isInternalFrame(line) ) {\r\n\t\t\t\tgoodLines.push( line );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn goodLines.join(\"\\n\");\r\n\t}\r\n\r\n\tfunction isNodeFrame( stackLine ) {\r\n\t\treturn stackLine.indexOf(\"(module.js:\") !== -1 ||\r\n\t\t\t   stackLine.indexOf(\"(node.js:\") !== -1;\r\n\t}\r\n\r\n\tfunction isInternalFrame( stackLine ) {\r\n\t\tvar pos = getFileNameAndLineNumber( stackLine );\r\n\t\treturn !!pos &&\r\n\t\t\tpos.fileName === pFileName &&\r\n\t\t\tpos.lineNumber >= pStartingLine &&\r\n\t\t\tpos.lineNumber <= pEndingLine;\r\n\t}\r\n\r\n\tvar STACK_JUMP_SEPARATOR = \"\\nFrom previous event:\\n\";\r\n\r\n\tfunction makeStackTraceLong( error ) {\r\n\t\tif ( error instanceof Error ) {\r\n\t\t\tvar stack = error.stack;\r\n\r\n\t\t\tif ( !stack ) {\r\n\t\t\t\tstack = withStack( error ).stack;\r\n\r\n\t\t\t} else if ( ~stack.indexOf(STACK_JUMP_SEPARATOR) ) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif ( stack ) {\r\n\t\t\t\terror.stack = [ filterStackString( stack, 0 ) ]\r\n\t\t\t\t\t.concat( currentTrace || [] )\r\n\t\t\t\t\t.join(STACK_JUMP_SEPARATOR);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t//__________________________________________________________________________\r\n\r\n\tvar\r\n\t\tisNodeJS = ot(typeof process) && process != null &&\r\n\t\t\t({}).toString.call(process) === \"[object process]\",\r\n\r\n\t\thasSetImmediate = typeof setImmediate === \"function\",\r\n\r\n\t\tgMutationObserver =\r\n\t\t\tot(typeof MutationObserver) && MutationObserver ||\r\n\t\t\tot(typeof WebKitMutationObserver) && WebKitMutationObserver,\r\n\r\n\t\thead = new TaskNode(),\r\n\t\ttail = head,\r\n\t\tflushing = false,\r\n\t\tnFreeTaskNodes = 0,\r\n\r\n\t\trequestFlush =\r\n\t\t\tisNodeJS ? requestFlushForNodeJS :\r\n\t\t\tgMutationObserver ? makeRequestCallFromMutationObserver( flush ) :\r\n\t\t\tmakeRequestCallFromTimer( flush ),\r\n\r\n\t\tpendingErrors = [],\r\n\t\trequestErrorThrow = makeRequestCallFromTimer( throwFirstError ),\r\n\r\n\t\thandleError,\r\n\r\n\t\tdomain,\r\n\r\n\t\tcall = ot.call,\r\n\t\tapply = ot.apply;\r\n\r\n\ttail.next = head;\r\n\r\n\tfunction TaskNode() {\r\n\t\tthis.a = null;\r\n\t\tthis.b = null;\r\n\t\tthis.next = null;\r\n\t}\r\n\r\n\tfunction ot( type ) {\r\n\t\treturn type === \"object\" || type === \"function\";\r\n\t}\r\n\r\n\tfunction throwFirstError() {\r\n\t\tif ( pendingErrors.length ) {\r\n\t\t\tthrow pendingErrors.shift();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction flush() {\r\n\t\twhile ( head !== tail ) {\r\n\t\t\tvar h = head = head.next;\r\n\r\n\t\t\tif ( nFreeTaskNodes >= 1024 ) {\r\n\t\t\t\ttail.next = tail.next.next;\r\n\t\t\t} else {\r\n\t\t\t\t++nFreeTaskNodes;\r\n\t\t\t}\r\n\r\n\t\t\tvar a = h.a;\r\n\t\t\tvar b = h.b;\r\n\t\t\th.a = null;\r\n\t\t\th.b = null;\r\n\r\n\t\t\tThen( a, b );\r\n\t\t}\r\n\r\n\t\tflushing = false;\r\n\t\tcurrentTrace = null;\r\n\t}\r\n\r\n\tfunction scheduleThen( a, b ) {\r\n\t\tvar node = tail.next;\r\n\r\n\t\tif ( node === head ) {\r\n\t\t\ttail.next = node = new TaskNode();\r\n\t\t\tnode.next = head;\r\n\t\t} else {\r\n\t\t\t--nFreeTaskNodes;\r\n\t\t}\r\n\r\n\t\ttail = node;\r\n\r\n\t\tnode.a = a;\r\n\t\tnode.b = b;\r\n\r\n\t\tif ( !flushing ) {\r\n\t\t\tflushing = true;\r\n\t\t\trequestFlush();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction requestFlushForNodeJS() {\r\n\t\tvar currentDomain = process.domain;\r\n\r\n\t\tif ( currentDomain ) {\r\n\t\t\tif ( !domain ) domain = (1,require)(\"domain\");\r\n\t\t\tdomain.active = process.domain = null;\r\n\t\t}\r\n\r\n\t\tif ( flushing && hasSetImmediate ) {\r\n\t\t\tsetImmediate( flush );\r\n\r\n\t\t} else {\r\n\t\t\tprocess.nextTick( flush );\r\n\t\t}\r\n\r\n\t\tif ( currentDomain ) {\r\n\t\t\tdomain.active = process.domain = currentDomain;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction makeRequestCallFromMutationObserver( callback ) {\r\n\t\tvar toggle = 1;\r\n\t\tvar node = document.createTextNode(\"\");\r\n\t\tvar observer = new gMutationObserver( callback );\r\n\t\tobserver.observe( node, {characterData: true} );\r\n\r\n\t\treturn function() {\r\n\t\t\ttoggle = -toggle;\r\n\t\t\tnode.data = toggle;\r\n\t\t};\r\n\t}\r\n\r\n\tfunction makeRequestCallFromTimer( callback ) {\r\n\t\treturn function() {\r\n\t\t\tvar timeoutHandle = setTimeout( handleTimer, 0 );\r\n\t\t\tvar intervalHandle = setInterval( handleTimer, 50 );\r\n\r\n\t\t\tfunction handleTimer() {\r\n\t\t\t\tclearTimeout( timeoutHandle );\r\n\t\t\t\tclearInterval( intervalHandle );\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tif ( isNodeJS ) {\r\n\t\thandleError = function( e ) {\r\n\t\t\tcurrentTrace = null;\r\n\t\t\trequestFlush();\r\n\t\t\tthrow e;\r\n\t\t};\r\n\r\n\t} else {\r\n\t\thandleError = function( e ) {\r\n\t\t\tpendingErrors.push( e );\r\n\t\t\trequestErrorThrow();\r\n\t\t}\r\n\t}\r\n\r\n\t//__________________________________________________________________________\r\n\r\n\r\n\tvar PENDING = 0;\r\n\tvar FULFILLED = 1;\r\n\tvar REJECTED = 2;\r\n\r\n\tvar OP_CALL = 0;\r\n\tvar OP_THEN = -1;\r\n\tvar OP_MULTIPLE = -2;\r\n\r\n\tvar VOID = P(void 0);\r\n\r\n\tfunction DoneEb( e ) {\r\n\t\tif ( P.onerror ) {\r\n\t\t\t(1,P.onerror)( e );\r\n\r\n\t\t} else {\r\n\t\t\tthrow e;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction ReportIfRejected( p ) {\r\n\t\tif ( p._state === REJECTED ) {\r\n\t\t\tif ( p._domain ) {\r\n\t\t\t\tp._domain.enter();\r\n\t\t\t}\r\n\r\n\t\t\thandleError( p._value );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction P( x ) {\r\n\t\treturn x instanceof Promise ?\r\n\t\t\tx :\r\n\t\t\tResolve( new Promise(), x );\r\n\t}\r\n\r\n\tP.longStackSupport = false;\r\n\r\n\tfunction Fulfill( p, value ) {\r\n\t\tif ( p._state ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tp._state = FULFILLED;\r\n\t\tp._value = value;\r\n\r\n\t\tHandleSettled( p );\r\n\t}\r\n\r\n\tfunction Reject( p, reason ) {\r\n\t\tif ( p._state ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif ( currentTrace ) {\r\n\t\t\tmakeStackTraceLong( reason );\r\n\t\t}\r\n\r\n\t\tp._state = REJECTED;\r\n\t\tp._value = reason;\r\n\r\n\t\tif ( isNodeJS ) {\r\n\t\t\tp._domain = process.domain;\r\n\t\t}\r\n\r\n\t\tHandleSettled( p );\r\n\t}\r\n\r\n\tfunction Propagate( parent, p ) {\r\n\t\tif ( p._state ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tp._state = parent._state;\r\n\t\tp._value = parent._value;\r\n\t\tp._domain = parent._domain;\r\n\r\n\t\tHandleSettled( p );\r\n\t}\r\n\r\n\tfunction Resolve( p, x ) {\r\n\t\tif ( p._state ) {\r\n\t\t\treturn p;\r\n\t\t}\r\n\r\n\t\tif ( x instanceof Promise ) {\r\n\t\t\tResolveWithPromise( p, x );\r\n\r\n\t\t} else {\r\n\t\t\tvar type = typeof x;\r\n\r\n\t\t\tif ( type === \"object\" && x !== null || type === \"function\" ) {\r\n\t\t\t\tResolveWithObject( p, x )\r\n\r\n\t\t\t} else {\r\n\t\t\t\tFulfill( p, x );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn p;\r\n\t}\r\n\r\n\tfunction ResolveWithPromise( p, x ) {\r\n\t\tif ( x === p ) {\r\n\t\t\tReject( p, new TypeError(\"You can't resolve a promise with itself\") );\r\n\r\n\t\t} else if ( x._state ) {\r\n\t\t\tPropagate( x, p );\r\n\r\n\t\t} else {\r\n\t\t\tOnSettled( x, OP_THEN, p );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction ResolveWithObject( p, x ) {\r\n\t\tvar then = GetThen( p, x );\r\n\r\n\t\tif ( typeof then === \"function\" ) {\r\n\t\t\tTryResolver( resolverFor(p, false), then, x );\r\n\r\n\t\t} else {\r\n\t\t\tFulfill( p, x );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction GetThen( p, x ) {\r\n\t\ttry {\r\n\t\t\treturn x.then;\r\n\r\n\t\t} catch ( e ) {\r\n\t\t\tReject( p, e );\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction TryResolver( d, resolver, x ) {\r\n\t\ttry {\r\n\t\t\tcall.call( resolver, x, d.resolve, d.reject );\r\n\r\n\t\t} catch ( e ) {\r\n\t\t\td.reject( e );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction HandleSettled( p ) {\r\n\t\tif ( p._pending ) {\r\n\t\t\tHandlePending( p, p._op, p._pending );\r\n\t\t\tp._pending = null;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction HandlePending( p, op, pending ) {\r\n\t\tif ( op >= 0 ) {\r\n\t\t\tpending( p, op );\r\n\r\n\t\t} else if ( op === OP_THEN ) {\r\n\t\t\tscheduleThen( p, pending );\r\n\r\n\t\t} else {\r\n\t\t\tfor ( var i = 0, l = pending.length; i < l; i += 2 ) {\r\n\t\t\t\tHandlePending( p, pending[i], pending[i + 1] );\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction OnSettled( p, op, pending ) {\r\n\t\tif ( p._state ) {\r\n\t\t\tHandlePending( p, op, pending );\r\n\r\n\t\t} else if ( !p._pending ) {\r\n\t\t\tp._pending = pending;\r\n\t\t\tp._op = op;\r\n\r\n\t\t} else if ( p._op === OP_MULTIPLE ) {\r\n\t\t\tp._pending.push( op, pending );\r\n\r\n\t\t} else {\r\n\t\t\tp._pending = [ p._op, p._pending, op, pending ];\r\n\t\t\tp._op = OP_MULTIPLE;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction Then( parent, p ) {\r\n\t\tvar domain = parent._domain || p._domain;\r\n\r\n\t\tcurrentTrace = p._trace;\r\n\r\n\t\tvar cb = parent._state === FULFILLED ? p._cb : p._eb;\r\n\r\n\t\tp._cb = null;\r\n\t\tp._eb = null;\r\n\t\tp._domain = null;\r\n\t\tp._trace = null;\r\n\r\n\t\tif ( cb === null ) {\r\n\t\t\tPropagate( parent, p );\r\n\r\n\t\t} else if ( domain ) {\r\n\t\t\tif ( !domain._disposed ) {\r\n\t\t\t\tdomain.enter();\r\n\t\t\t\tHandleCallback( p, cb, parent._value );\r\n\t\t\t\tdomain.exit();\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\t\t\tHandleCallback( p, cb, parent._value );\r\n\t\t}\r\n\t}\r\n\r\n\tfunction HandleCallback( p, cb, value ) {\r\n\t\tvar x;\r\n\r\n\t\ttry {\r\n\t\t\tx = cb( value );\r\n\r\n\t\t} catch ( e ) {\r\n\t\t\tReject( p, e );\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tResolve( p, x );\r\n\t}\r\n\r\n\tfunction resolverFor( promise, nodelike ) {\r\n\t\tvar trace = P.longStackSupport ? getTrace() : null;\r\n\r\n\t\tfunction resolve( error, y ) {\r\n\t\t\tif ( promise ) {\r\n\t\t\t\tvar p = promise;\r\n\t\t\t\tpromise = null;\r\n\r\n\t\t\t\tif ( trace ) {\r\n\t\t\t\t\tif ( currentTrace ) {\r\n\t\t\t\t\t\ttrace = null;\r\n\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tcurrentTrace = trace;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( error ) {\r\n\t\t\t\t\tReject( p, nodelike ? error : y );\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\tResolve( p, y );\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif ( trace ) {\r\n\t\t\t\t\tcurrentTrace = trace = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn nodelike ? resolve : {\r\n\t\t\tpromise: promise,\r\n\r\n\t\t\tresolve: function( y ) {\r\n\t\t\t\tresolve( false, y );\r\n\t\t\t},\r\n\r\n\t\t\treject: function( reason ) {\r\n\t\t\t\tresolve( true, reason );\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\tP.defer = defer;\r\n\tfunction defer() {\r\n\t\treturn resolverFor( new Promise(), false );\r\n\t}\r\n\r\n\tP.reject = reject;\r\n\tfunction reject( reason ) {\r\n\t\tvar promise = new Promise();\r\n\t\tReject( promise, reason );\r\n\t\treturn promise;\r\n\t}\r\n\r\n\tfunction Promise() {\r\n\t\tthis._state = 0;\r\n\t\tthis._value = void 0;\r\n\t\tthis._domain = null;\r\n\t\tthis._cb = null;\r\n\t\tthis._eb = null;\r\n\t\tthis._op = 0;\r\n\t\tthis._pending = null;\r\n\t\tthis._trace = null;\r\n\t}\r\n\r\n\tPromise.prototype._clone = function() {\r\n\t\tvar promise = new Promise();\r\n\t\tResolveWithPromise( promise, this );\r\n\t\treturn promise;\r\n\t};\r\n\r\n\tPromise.prototype.then = function( onFulfilled, onRejected ) {\r\n\t\tvar promise = new Promise();\r\n\r\n\t\tpromise._cb = typeof onFulfilled === \"function\" ? onFulfilled : null;\r\n\t\tpromise._eb = typeof onRejected === \"function\" ? onRejected : null;\r\n\r\n\t\tif ( P.longStackSupport ) {\r\n\t\t\tpromise._trace = getTrace();\r\n\t\t}\r\n\r\n\t\tif ( isNodeJS ) {\r\n\t\t\tpromise._domain = process.domain;\r\n\t\t}\r\n\r\n\t\tif ( this._state ) {\r\n\t\t\tscheduleThen( this, promise );\r\n\r\n\t\t} else {\r\n\t\t\tOnSettled( this, OP_THEN, promise );\r\n\t\t}\r\n\r\n\t\treturn promise;\r\n\t};\r\n\r\n\tPromise.prototype.done = function( cb, eb ) {\r\n\t\tvar p = this;\r\n\r\n\t\tif ( cb || eb ) {\r\n\t\t\tp = p.then( cb, eb );\r\n\t\t}\r\n\r\n\t\tp = p.then( null, DoneEb );\r\n\r\n\t\tOnSettled( p, OP_CALL, ReportIfRejected );\r\n\t};\r\n\r\n\tPromise.prototype.fail = function( eb ) {\r\n\t\treturn this.then( null, eb );\r\n\t};\r\n\r\n\tPromise.prototype.fin = function( cb ) {\r\n\t\tvar p = this;\r\n\t\tvar promise = p.then( _finally, _finally );\r\n\r\n\t\tfunction _finally() {\r\n\t\t\treturn P( cb() ).then(function() {\r\n\t\t\t\tPropagate( p, promise );\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn promise;\r\n\t};\r\n\r\n\tPromise.prototype.spread = function( cb, eb ) {\r\n\t\treturn this.then( _all ).then(function( args ) {\r\n\t\t\treturn apply.call( cb, void 0, args );\r\n\t\t}, eb);\r\n\t};\r\n\r\n\tPromise.prototype.timeout = function( ms, msg ) {\r\n\t\tvar promise = this._clone();\r\n\r\n\t\tif ( this._state === PENDING ) {\r\n\t\t\tvar trace = P.longStackSupport ? getTrace() : null;\r\n\t\t\tvar timeoutId = setTimeout(function() {\r\n\t\t\t\tcurrentTrace = trace;\r\n\t\t\t\tReject( promise, new Error(msg || \"Timed out after \" + ms + \" ms\") );\r\n\t\t\t\tcurrentTrace = null;\r\n\t\t\t}, ms);\r\n\r\n\t\t\tOnSettled( this, OP_CALL, function() {\r\n\t\t\t\tclearTimeout( timeoutId );\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn promise;\r\n\t};\r\n\r\n\tPromise.prototype.delay = function( ms ) {\r\n\t\tvar promise = new Promise();\r\n\r\n\t\tOnSettled(this, OP_CALL, function( p ) {\r\n\t\t\tif ( p._state === FULFILLED ) {\r\n\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\tPropagate( p, promise );\r\n\t\t\t\t}, ms);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tVOID.then(function() {\r\n\t\t\t\t\tPropagate( p, promise );\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn promise;\r\n\t};\r\n\r\n\tPromise.prototype.all = function() {\r\n\t\treturn this.then( _all );\r\n\t};\r\n\r\n\tPromise.prototype.allSettled = function() {\r\n\t\treturn this.then( _allSettled );\r\n\t};\r\n\r\n\tPromise.prototype.inspect = function() {\r\n\t\tswitch ( this._state ) {\r\n\t\t\tcase PENDING:   return { state: \"pending\" };\r\n\t\t\tcase FULFILLED: return { state: \"fulfilled\", value: this._value };\r\n\t\t\tcase REJECTED:  return { state: \"rejected\", reason: this._value };\r\n\t\t\tdefault: throw new TypeError(\"invalid state\");\r\n\t\t}\r\n\t};\r\n\r\n\tPromise.prototype.nodeify = function( nodeback ) {\r\n\t\tif ( nodeback ) {\r\n\t\t\tthis.done(function( value ) {\r\n\t\t\t\tnodeback( null, value );\r\n\t\t\t}, nodeback);\r\n\t\t\treturn void 0;\r\n\r\n\t\t} else {\r\n\t\t\treturn this;\r\n\t\t}\r\n\t};\r\n\r\n\tP.allSettled = allSettled;\r\n\tfunction allSettled( input ) {\r\n\t\tvar promise = _allSettled( input );\r\n\t\t// Ensure propagation doesn't overflew the stack.\r\n\t\treturn promise._state ? promise : promise._clone();\r\n\t}\r\n\r\n\tfunction _allSettled( input ) {\r\n\t\tvar promise = new Promise();\r\n\t\tvar len = input.length;\r\n\r\n\t\tif ( typeof len !== \"number\" ) {\r\n\t\t\tReject( promise, new TypeError(\"input not array-like\") );\r\n\t\t\treturn promise;\r\n\t\t}\r\n\r\n\t\tvar output = new Array( len );\r\n\t\tvar waiting = len;\r\n\r\n\t\tfunction onSettled( p, i ) {\r\n\t\t\toutput[ i ] = p.inspect();\r\n\t\t\tif ( --waiting === 0 ) {\r\n\t\t\t\tFulfill( promise, output );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0; i < len; ++i ) {\r\n\t\t\tOnSettled( P(input[i]), i, onSettled );\r\n\t\t}\r\n\r\n\t\tif ( waiting === 0 ) {\r\n\t\t\tFulfill( promise, output );\r\n\t\t}\r\n\r\n\t\treturn promise;\r\n\t}\r\n\r\n\tP.all = all;\r\n\tfunction all( input ) {\r\n\t\tvar promise = _all( input );\r\n\t\t// Ensure propagation doesn't overflew the stack.\r\n\t\treturn promise._state ? promise : promise._clone();\r\n\t}\r\n\r\n\tfunction _all( input ) {\r\n\t\tvar promise = new Promise();\r\n\t\tvar len = input.length;\r\n\t\tvar ret = promise;\r\n\r\n\t\tif ( typeof len !== \"number\" ) {\r\n\t\t\tReject( promise, new TypeError(\"input not array-like\") );\r\n\t\t\treturn promise;\r\n\t\t}\r\n\r\n\t\tvar output = new Array( len );\r\n\t\tvar waiting = len;\r\n\r\n\t\tfunction onSettled( p, i ) {\r\n\t\t\tif ( output !== null ) {\r\n\t\t\t\tif ( p._state === REJECTED ) {\r\n\t\t\t\t\toutput = null;\r\n\t\t\t\t\tPropagate( p, promise );\r\n\t\t\t\t\tpromise = null;\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\t\toutput[ i ] = p._value;\r\n\t\t\t\t\tif ( --waiting === 0 ) {\r\n\t\t\t\t\t\tFulfill( promise, output );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor ( var i = 0; i < len; ++i ) {\r\n\t\t\tOnSettled( P(input[i]), i, onSettled );\r\n\t\t}\r\n\r\n\t\tif ( waiting === 0 ) {\r\n\t\t\tFulfill( promise, output );\r\n\t\t}\r\n\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tP.spread = spread;\r\n\tfunction spread( values, cb, eb ) {\r\n\t\treturn _all( values ).then(function( args ) {\r\n\t\t\treturn apply.call( cb, void 0, args );\r\n\t\t}, eb);\r\n\t}\r\n\r\n\tP.promised = promised;\r\n\tfunction promised( f ) {\r\n\t\tfunction onFulfilled( thisAndArgs ) {\r\n\t\t\treturn call.apply( f, thisAndArgs );\r\n\t\t}\r\n\r\n\t\treturn function() {\r\n\t\t\tvar len = arguments.length;\r\n\t\t\tvar thisAndArgs = new Array( len + 1 );\r\n\t\t\tthisAndArgs[0] = this;\r\n\t\t\tfor ( var i = 0; i < len; ++i ) {\r\n\t\t\t\tthisAndArgs[ i + 1 ] = arguments[ i ];\r\n\t\t\t}\r\n\t\t\treturn _all( thisAndArgs ).then( onFulfilled );\r\n\t\t};\r\n\t}\r\n\r\n\tP.denodeify = denodeify;\r\n\tfunction denodeify( f ) {\r\n\t\treturn function() {\r\n\t\t\tvar promise = new Promise();\r\n\r\n\t\t\tvar i = arguments.length;\r\n\t\t\tvar args = new Array( i + 1 );\r\n\t\t\targs[i] = resolverFor( promise, true );\r\n\t\t\twhile ( i-- ) {\r\n\t\t\t\targs[i] = arguments[i];\r\n\t\t\t}\r\n\r\n\t\t\tTryApply( promise, f, this, args );\r\n\r\n\t\t\treturn promise;\r\n\t\t};\r\n\t}\r\n\r\n\tfunction TryApply( p, f, that, args ) {\r\n\t\ttry {\r\n\t\t\tapply.call( f, that, args );\r\n\r\n\t\t} catch ( e ) {\r\n\t\t\tReject( p, e );\r\n\t\t}\r\n\t}\r\n\r\n\tP.onerror = null;\r\n\r\n\tP.nextTick = function nextTick( task ) {\r\n\t\t// We don't use .done to avoid P.onerror.\r\n\t\tvar p = VOID.then(function() {\r\n\t\t\ttask.call();\r\n\t\t});\r\n\t\tOnSettled( p, OP_CALL, ReportIfRejected );\r\n\t};\r\n\r\n\tvar pEndingLine = captureLine();\r\n\r\n\treturn P;\r\n});\r\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n\n/**\n * Simple function helpers.\n *\n * @class Function\n * @static\n */\ndefine('client/lib/function',[],function () {\n  'use strict';\n\n  function partial(method/*, ...*/) {\n    var args = [].slice.call(arguments, 1);\n    return function () {\n      return method.apply(this, args.concat([].slice.call(arguments, 0)));\n    };\n  }\n\n\n  return {\n    /**\n     * Partially apply a function by filling in any number of its arguments,\n     * without changing its dynamic this value. A close cousin of\n     * [Function.prototype.bind](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Function/bind).\n     *\n     * @example\n     *     function add(a, b) {\n     *       return a + b;\n     *     }\n     *\n     *     var add10To = partial(add, 10);\n     *     var result = add10To(9);\n     *     // result is 19\n     *\n     * @method partial\n     * @param method {Function}\n     * Method to call with the arguments on final evaluation.\n     * @returns {Function}\n     */\n    partial: partial\n  };\n});\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/**\n * Helper functions for working with Objects\n *\n * @class Object\n * @static\n */\ndefine('client/lib/object',[], function () {\n  'use strict';\n\n  /**\n   * Extend an object with properties of one or more objects.\n   * @method extend\n   * @param {Object} target\n   * Target object\n   */\n  function extend(target/*, ...*/) {\n    var sources = [].slice.call(arguments, 1);\n\n    for (var index = 0, source; source = sources[index]; ++index) {\n      for (var key in source) {\n        target[key] = source[key];\n      }\n    }\n\n    return target;\n  }\n\n  return {\n    extend: extend\n  };\n});\n\n\n\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/**\n * Helper functions for working with options\n *\n * @class Options\n * @static\n */\n\n\ndefine('client/lib/options',[], function () {\n  'use strict';\n\n  /**\n   * Check an object for a list of required options\n   *\n   * @method checkRequired\n   * @param {Array of Strings} requiredOptions\n   * @param {Object} options\n   * @throws {Error}\n   * if a required option is missing\n   */\n  function checkRequired(requiredOptions, options) {\n    for (var i = 0, requiredOption; requiredOption = requiredOptions[i]; ++i) {\n      if (! (requiredOption in options)) {\n        throw new Error(requiredOption + ' is required');\n      }\n    }\n  }\n\n  return {\n    checkRequired: checkRequired\n  };\n\n});\n\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/**\n * Constants\n *\n * @class Constants\n * @static\n */\ndefine('client/lib/constants',[], function () {\n  'use strict';\n\n  return {\n    /**\n     * Default content server host\n     * @property DEFAULT_CONTENT_HOST\n     * @type {String}\n     */\n    DEFAULT_CONTENT_HOST: 'https://accounts.firefox.com',\n    /**\n     * Default oauth server host\n     * @property DEFAULT_OAUTH_HOST\n     * @type {String}\n     */\n    DEFAULT_OAUTH_HOST: 'https://oauth.accounts.firefox.com/v1',\n    /**\n     * Default profile server host\n     * @property DEFAULT_PROFILE_HOST\n     * @type {String}\n     */\n    DEFAULT_PROFILE_HOST: 'https://profile.accounts.firefox.com/v1',\n    /**\n     * Sign in action\n     * @property SIGNIN_ACTION\n     * @type {String}\n     */\n    SIGNIN_ACTION: 'signin',\n    /**\n     * Sign up action\n     * @property SIGNUP_ACTION\n     * @type {String}\n     */\n    SIGNUP_ACTION: 'signup',\n    /**\n     * Force auth action\n     * @property FORCE_AUTH_ACTION\n     * @type {String}\n     */\n    FORCE_AUTH_ACTION: 'force_auth',\n    /**\n     * Best choice action\n     * @property BEST_CHOICE_ACTION\n     * @type {String}\n     */\n    BEST_CHOICE_ACTION: null\n  };\n});\n\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/**\n * Helpers functions to work with URLs\n *\n * @class Url\n * @static\n */\ndefine('client/lib/url',[], function () {\n  'use strict';\n\n  /**\n   * Create a query parameter string from a key and value\n   *\n   * @method createQueryParam\n   * @param {String} key\n   * @param {Variant} value\n   * @returns {String}\n   * URL safe serialized query parameter\n   */\n  function createQueryParam(key, value) {\n    return encodeURIComponent(key) + '=' + encodeURIComponent(value);\n  }\n\n  /**\n   * Create a query string out of an object.\n   * @method objectToQueryString\n   * @param {Object} obj\n   * Object to create query string from\n   * @returns {String}\n   * URL safe query string\n   */\n  function objectToQueryString(obj) {\n    var queryParams = [];\n\n    for (var key in obj) {\n      queryParams.push(createQueryParam(key, obj[key]));\n    }\n\n    return '?' + queryParams.join('&');\n  }\n\n  return {\n    createQueryParam: createQueryParam,\n    objectToQueryString: objectToQueryString\n  };\n});\n\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/*globals define*/\n\ndefine('client/auth/base/api',[\n  'p-promise',\n  'client/lib/constants',\n  'client/lib/options',\n  'client/lib/function',\n  'client/lib/url'\n], function (p, Constants, Options, FunctionHelpers, Url) {\n  'use strict';\n\n  var partial = FunctionHelpers.partial;\n\n  /**\n   * The base class for other brokers. Subclasses must override\n   * `openFxa`. Provides a strategy to authenticate a user.\n   *\n   * @class BaseBroker\n   * @constructor\n   * @param {string} clientId - the OAuth client ID for the relier\n   * @param {Object} [options={}] - configuration\n   *   @param {String} [options.oauthHost]\n   *   Firefox Accounts OAuth Server host\n   *   @param {Object} [options.window]\n   *   window override, used for unit tests\n   *   @param {Object} [options.lightbox]\n   *   lightbox override, used for unit tests\n   *   @param {Object} [options.channel]\n   *   channel override, used for unit tests\n   */\n  function BaseBroker(clientId, options) {\n    if (! clientId) {\n      throw new Error('clientId is required');\n    }\n\n    this._clientId = clientId;\n    this._oauthHost = options.oauthHost || Constants.DEFAULT_OAUTH_HOST;\n    this._window = options.window || window;\n  }\n\n  function authenticate(action, config) {\n    //jshint validthis: true\n    var self = this;\n    config = config || {};\n    return p().then(function () {\n      var requiredOptions = ['scope', 'state', 'redirectUri'];\n      Options.checkRequired(requiredOptions, config);\n\n      var fxaUrl = getOAuthUrl.call(self, action, config);\n      return self.openFxa(fxaUrl, config);\n    });\n  }\n\n  function getOAuthUrl(action, config) {\n    //jshint validthis: true\n    var queryParams = {\n      client_id: this._clientId,\n      state: config.state,\n      scope: config.scope,\n      redirect_uri: config.redirectUri\n    };\n\n    if (action) {\n      queryParams.action = action;\n    }\n\n    if (config.email) {\n      queryParams.email = config.email;\n    }\n\n    if (this._context) {\n      queryParams.context = this._context;\n    }\n\n    return this._oauthHost + '/authorization' + Url.objectToQueryString(queryParams);\n  }\n\n  BaseBroker.prototype = {\n    _context: null,\n    /**\n     * Set the `context` field to be passed to the content server. If not\n     * set, no context will be sent. Should be called by sub-classes if\n     * a context is needed.\n     *\n     * @method setContext\n     * @param {String} context\n     */\n    setContext: function (context) {\n      this._context = context;\n    },\n\n    /**\n     * Open Firefox Accounts to authenticate the user.\n     * Must be overridden to provide API specific functionality.\n     *\n     * @method openFxa\n     * @param {String} fxaUrl - URL to open for authentication\n     * @param {options={}} options\n     *\n     * @protected\n     */\n    openFxa: function (fxaUrl, options) {\n      throw new Error('openFxa must be overridden');\n    },\n\n    /**\n     * Sign in an existing user\n     *\n     * @method signIn\n     * @param {Object} config - configuration\n     *   @param {String} config.state\n     *   CSRF/State token\n     *   @param {String} config.redirectUri\n     *   URI to redirect to when complete\n     *   @param {String} config.scope\n     *   OAuth scope\n     *   @param {String} [config.email]\n     *   Email address used to pre-fill into the account form,\n     *   but the user is free to change it. Set to the string literal\n     *   `blank` to ignore any previously signed in email. Default is\n     *   the last email address used to sign in.\n     */\n    signIn: partial(authenticate, Constants.SIGNIN_ACTION),\n\n    /**\n     * Force a user to sign in as an existing user.\n     *\n     * @method forceAuth\n     * @param {Object} config - configuration\n     *   @param {String} config.state\n     *   CSRF/State token\n     *   @param {String} config.redirectUri\n     *   URI to redirect to when complete\n     *   @param {String} config.scope\n     *   OAuth scope\n     *   @param {String} config.email\n     *   Email address the user must sign in with. The user\n     *   is unable to modify the email address and is unable\n     *   to sign up if the address is not registered.\n     *   @param {String} [config.ui]\n     *   UI to present - `lightbox` or `redirect` - defaults to `redirect`\n     */\n    forceAuth: function (config) {\n      var self = this;\n      return p().then(function () {\n        config = config || {};\n        var requiredOptions = ['email'];\n        Options.checkRequired(requiredOptions, config);\n\n        return authenticate.call(self, Constants.FORCE_AUTH_ACTION, config);\n      });\n    },\n\n    /**\n     * Sign up a new user\n     *\n     * @method signUp\n     * @param {Object} config - configuration\n     *   @param {String} config.state\n     *   CSRF/State token\n     *   @param {String} config.redirectUri\n     *   URI to redirect to when complete\n     *   @param {String} config.scope\n     *   OAuth scope\n     *   @param {String} [config.email]\n     *   Email address used to pre-fill into the account form,\n     *   but the user is free to change it.\n     */\n    signUp: partial(authenticate, Constants.SIGNUP_ACTION),\n\n    /**\n     * Best choice auth strategy, has no action set\n     *\n     * @method bestChoice\n     * @param {Object} config - configuration\n     *   @param {String} config.state\n     *   CSRF/State token\n     *   @param {String} config.redirectUri\n     *   URI to redirect to when complete\n     *   @param {String} config.scope\n     *   OAuth scope\n     *   @param {String} [config.email]\n     *   Email address used to pre-fill into the account form,\n     *   but the user is free to change it.\n     */\n    bestChoice: partial(authenticate, Constants.BEST_CHOICE_ACTION)\n  };\n\n  return BaseBroker;\n});\n\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/*globals define*/\n\ndefine('client/auth/lightbox/lightbox',[\n], function () {\n  'use strict';\n\n  function createElement(window, type, attributes) {\n    var el = window.document.createElement(type);\n\n    for (var attribute in attributes) {\n      el.setAttribute(attribute, attributes[attribute]);\n    }\n\n    return el;\n  }\n\n  function cssPropsToString(props) {\n    var str = '';\n\n    for (var key in props) {\n      str += key + ':' + props[key] + ';';\n    }\n\n    return str;\n  }\n\n\n  /**\n   * Create a lightbox.\n   *\n   * @class Lightbox\n   * @constructor\n   * @param {options={}} options\n   * @param {String} options.window\n   * The window object\n   */\n  function Lightbox(options) {\n    options = options || {};\n\n    this._window = options.window;\n  }\n\n  Lightbox.prototype = {\n    /**\n     * Load content into the lightbox\n     * @method load\n     * @param {String} src\n     * URL to load.\n     * @param {options={}} options\n     * @param {Number} [options.zIndex]\n     * z-index to set on the background.\n     * @default 100\n     * @param {String} [options.background]\n     * Lightbox background CSS.\n     * @default rgba(0,0,0,0.5)\n     */\n    load: function (src, options) {\n      options = options || {};\n\n      var backgroundStyle = options.background || 'rgba(0,0,0,0.5)';\n      var zIndexStyle = options.zIndex || 100;\n\n      var background = this._backgroundEl = createElement(this._window, 'div', {\n        id: 'fxa-background',\n        style: cssPropsToString({\n          background: backgroundStyle,\n          bottom: 0,\n          left: 0,\n          position: 'fixed',\n          right: 0,\n          top: 0,\n          'z-index': zIndexStyle\n        })\n      });\n\n      var iframe = createElement(this._window, 'iframe', {\n        id: 'fxa',\n        src: src,\n        width: '600',\n        height: '400',\n        allowtransparency: 'true',\n        border: '0',\n        style: cssPropsToString({\n          background: 'transparent',\n          border: 'none',\n          display: 'block',\n          height: '600px',\n          margin: '0 auto 0 auto',\n          position: 'relative',\n          top: '10%',\n          width: '400px'\n        })\n      });\n\n      background.appendChild(iframe);\n      this._window.document.body.appendChild(background);\n\n      this._iframe = iframe;\n      this._contentWindow = iframe.contentWindow;\n    },\n\n    /**\n     * Get the content iframe element.\n     * @method getContentElement\n     * @returns {DOM Element}\n     */\n    getContentElement: function () {\n      return this._iframe;\n    },\n\n    /**\n     * Get the content window in the iframe.\n     * @method getContentWindow\n     * @returns {DOM Element}\n     */\n    getContentWindow: function () {\n      return this._contentWindow;\n    },\n\n    /**\n     * Check if the lightbox is loaded\n     * @method isLoaded\n     * @returns {Boolean}\n     */\n    isLoaded: function () {\n      return !! this._backgroundEl;\n    },\n\n    /**\n     * Unload the lightbox\n     * @method unload\n     */\n    unload: function () {\n      if (this._backgroundEl) {\n        this._window.document.body.removeChild(this._backgroundEl);\n        delete this._backgroundEl;\n        delete this._iframe;\n      }\n    }\n  };\n\n  return Lightbox;\n});\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/**\n * Communicate with an iframed content server.\n *\n * @class IFrameChannel\n */\ndefine('client/auth/lightbox/iframe_channel',[\n  'p-promise',\n  'client/lib/object'\n], function (p, ObjectHelpers) {\n  'use strict';\n\n  function IFrameChannel(options) {\n    options = options || {};\n\n    this._window = options.window;\n    this._contentWindow = options.contentWindow;\n    this._iframeHost = options.iframeHost;\n  }\n\n  IFrameChannel.prototype = {\n    /**\n     * Protocol version number. When the protocol to communicate with the\n     * content server changes, this should be bumped.\n     * @property version\n     * @type {String}\n     */\n    version: '0.0.0',\n\n    /**\n     * Start listening for messages from the iframe.\n     * @method attach\n     */\n    attach: function () {\n      this._boundOnMessage = onMessage.bind(this);\n      this._window.addEventListener('message', this._boundOnMessage, false);\n\n      this._deferred = p.defer();\n      return this._deferred.promise;\n    },\n\n    /**\n     * Stop listening for messages from the iframe.\n     * @method detach\n     */\n    detach: function () {\n      this._window.removeEventListener('message', this._boundOnMessage, false);\n    },\n\n    /**\n     * Send a message to the iframe.\n     *\n     * @method send\n     * @param {String} command\n     * Message to send.\n     * @param {Object} [data]\n     * Data to send.\n     */\n    send: function (command, data) {\n      var dataToSend = ObjectHelpers.extend({ version: this.version }, data);\n      var msg = stringifyFxAEvent(command, dataToSend);\n\n      this._contentWindow.postMessage(msg, this._iframeHost);\n    }\n  };\n\n  // commands that come from the iframe. They are called\n  // in the Lightbox object context.\n  var COMMANDS = {\n    error: function (command, data) {\n      this.detach();\n      this._deferred.reject(data);\n    },\n    /*jshint camelcase:false*/\n    ping: function (command, data) {\n      // ping is used to get the RP's origin. If the RP's origin is not\n      // whitelisted, it cannot be iframed.\n      this.send(command, data);\n    },\n    ignore: function (command, data) {\n      console.log('ignoring command: %s', command);\n    },\n    oauth_cancel: function (command, data) {\n      this.detach();\n      return this._deferred.reject({ reason: 'cancel' });\n    },\n    oauth_complete: function (command, data) {\n      this.detach();\n      this._deferred.resolve(data);\n    }\n  };\n\n  function onMessage(event) {\n    /*jshint validthis: true*/\n    if (event.origin !== this._iframeHost) {\n      return;\n    }\n\n    var parsed = parseFxAEvent(event.data);\n    var command = parsed.command;\n    var data = parsed.data;\n\n    var handler = COMMANDS[command] || COMMANDS.ignore;\n    handler.call(this, command, data);\n  }\n\n  function parseFxAEvent(msg) {\n    return JSON.parse(msg);\n  }\n\n  function stringifyFxAEvent(command, data) {\n    return JSON.stringify({\n      command: command,\n      data: data || {}\n    });\n  }\n\n  IFrameChannel.stringifyFxAEvent = stringifyFxAEvent;\n  IFrameChannel.parseFxAEvent = parseFxAEvent;\n\n  return IFrameChannel;\n});\n\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/*globals define*/\n\ndefine('client/auth/lightbox/api',[\n  'p-promise',\n  'client/lib/object',\n  'client/lib/options',\n  'client/lib/constants',\n  '../base/api',\n  './lightbox',\n  './iframe_channel'\n], function (p, ObjectHelpers, Options, Constants, BaseBroker,\n    Lightbox, IFrameChannel) {\n  'use strict';\n\n  function getLightbox() {\n    //jshint validthis: true\n    var self = this;\n    if (self._lightbox) {\n      return self._lightbox;\n    }\n\n    self._lightbox = new Lightbox({\n      window: self._window\n    });\n\n    return self._lightbox;\n  }\n\n  function openLightbox(fxaUrl, options) {\n    /*jshint validthis: true*/\n    var self = this;\n    return p().then(function() {\n      if (self._lightbox && self._lightbox.isLoaded()) {\n        throw new Error('lightbox already open');\n      }\n\n      var lightbox = getLightbox.call(self);\n\n      lightbox.load(fxaUrl, options);\n\n      return lightbox;\n    });\n  }\n\n  function getChannel(lightbox) {\n    //jshint validthis: true\n    var self = this;\n    if (self._channel) {\n      return self._channel;\n    }\n\n    self._channel = new IFrameChannel({\n      iframeHost: self._contentHost,\n      contentWindow: lightbox.getContentWindow(),\n      window: self._window\n    });\n\n    return self._channel;\n  }\n\n  function waitForAuthentication(lightbox) {\n    /*jshint validthis: true*/\n    var self = this;\n    return p().then(function () {\n      var channel = getChannel.call(self, lightbox);\n      return channel.attach();\n    });\n  }\n\n  /**\n   * Authenticate users with a lightbox\n   *\n   * @class LightboxBroker\n   * @extends BaseBroker\n   * @constructor\n   * @param {string} clientId - the OAuth client ID for the relier\n   * @param {Object} [options={}] - configuration\n   *   @param {String} [options.contentHost]\n   *   Firefox Accounts Content Server host\n   *   @param {String} [options.oauthHost]\n   *   Firefox Accounts OAuth Server host\n   *   @param {Object} [options.window]\n   *   window override, used for unit tests\n   *   @param {Object} [options.lightbox]\n   *   lightbox override, used for unit tests\n   *   @param {Object} [options.channel]\n   *   channel override, used for unit tests\n   */\n  function LightboxBroker(clientId, options) {\n    options = options || {};\n\n    BaseBroker.call(this, clientId, options);\n\n    this._lightbox = options.lightbox;\n    this._channel = options.channel;\n    this._contentHost = options.contentHost || Constants.DEFAULT_CONTENT_HOST;\n    this.setContext('iframe');\n  }\n  LightboxBroker.prototype = Object.create(BaseBroker.prototype);\n\n  ObjectHelpers.extend(LightboxBroker.prototype, {\n    openFxa: function (fxaUrl, options) {\n      /*jshint validthis: true*/\n      var self = this;\n\n      return openLightbox.call(self, fxaUrl, options)\n        .then(function (lightbox) {\n          return waitForAuthentication.call(self, lightbox);\n        })\n        .then(function (result) {\n          self.unload();\n          return result;\n        }, function (err) {\n          self.unload();\n          throw err;\n        });\n    },\n\n    /**\n     * Unload the lightbox\n     *\n     * @method unload\n     */\n    unload: function () {\n      var self = this;\n      return p().then(function () {\n        if (! self._lightbox) {\n          throw new Error('lightbox not open');\n        }\n\n        self._lightbox.unload();\n        self._channel.detach();\n      });\n    }\n  });\n\n  return LightboxBroker;\n});\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\ndefine('client/auth/redirect/api',[\n  '../base/api',\n  'client/lib/constants',\n  'client/lib/options',\n  'client/lib/object'\n], function (BaseBroker, Constants, Options, ObjectHelpers) {\n  'use strict';\n\n  /**\n   * Authenticate a user with the redirect flow.\n   *\n   * @class RedirectBroker\n   * @extends BaseBroker\n   * @constructor\n   */\n  function RedirectBroker(clientId, options) {\n    BaseBroker.call(this, clientId, options);\n  }\n\n  RedirectBroker.prototype = Object.create(BaseBroker.prototype);\n  ObjectHelpers.extend(RedirectBroker.prototype, {\n    openFxa: function (fxaUrl) {\n      this._window.location.href = fxaUrl;\n    }\n  });\n\n  return RedirectBroker;\n});\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\ndefine('client/auth/api',[\n  'p-promise',\n  'client/lib/function',\n  'client/auth/lightbox/api',\n  'client/auth/redirect/api'\n], function (p, FunctionHelpers, LightboxBroker, RedirectBroker) {\n  'use strict';\n\n  var partial = FunctionHelpers.partial;\n\n  var Brokers = {\n    'default': RedirectBroker,\n    lightbox: LightboxBroker,\n    redirect: RedirectBroker\n  };\n\n  function getBroker(context, ui, clientId, options) {\n    if (context._broker) {\n      throw new Error('Firefox Accounts is already open');\n    }\n\n    if (typeof ui === 'object') {\n      // allow a Broker to be passed in for testing.\n      context._broker = ui;\n    } else {\n      ui = ui || 'default';\n      var Broker = Brokers[ui];\n\n      if (! Broker) {\n        throw new Error('Invalid ui: ' + ui);\n      }\n\n      context._broker = new Broker(clientId, options);\n    }\n\n    return context._broker;\n  }\n\n  function authenticate(authType, config) {\n    //jshint validthis: true\n    var self = this;\n    return p().then(function () {\n      config = config || {};\n\n      var api = getBroker(self, config.ui, self._clientId, self._options);\n      return api[authType](config)\n        .fin(function () {\n          delete self._broker;\n        });\n    });\n  }\n\n\n  /**\n   * @class AuthAPI\n   * @constructor\n   * @param {string} clientId - the OAuth client ID for the relier\n   * @param {Object} [options={}] - configuration\n   *   @param {String} [options.contentHost]\n   *   Firefox Accounts Content Server host\n   *   @param {String} [options.oauthHost]\n   *   Firefox Accounts OAuth Server host\n   *   @param {Object} [options.window]\n   *   window override, used for unit tests\n   *   @param {Object} [options.lightbox]\n   *   lightbox override, used for unit tests\n   *   @param {Object} [options.channel]\n   *   channel override, used for unit tests\n   */\n  function AuthAPI(clientId, options) {\n    if (! clientId) {\n      throw new Error('clientId is required');\n    }\n\n    this._clientId = clientId;\n    this._options = options;\n  }\n\n  AuthAPI.prototype = {\n    /**\n     * Sign in an existing user.\n     *\n     * @method signIn\n     * @param {Object} config - configuration\n     *   @param {String} config.state\n     *   CSRF/State token\n     *   @param {String} config.redirectUri\n     *   URI to redirect to when complete\n     *   @param {String} config.scope\n     *   OAuth scope\n     *   @param {String} [config.email]\n     *   Email address used to pre-fill into the account form,\n     *   but the user is free to change it. Set to the string literal\n     *   `blank` to ignore any previously signed in email. Default is\n     *   the last email address used to sign in.\n     *   @param {String} [config.ui]\n     *   UI to present - `lightbox` or `redirect` - defaults to `redirect`\n     *   @param {Number} [options.zIndex]\n     *   only used when `config.ui=lightbox`. The zIndex of the lightbox background.\n     *   @default 100\n     *   @param {String} [options.background]\n     *   only used when `config.ui=lightbox`. The `background` CSS value\n     *   @default rgba(0,0,0,0.5)\n     */\n    signIn: partial(authenticate, 'signIn'),\n\n    /**\n     * Force a user to sign in as an existing user.\n     *\n     * @method forceAuth\n     * @param {Object} config - configuration\n     *   @param {String} config.state\n     *   CSRF/State token\n     *   @param {String} config.redirectUri\n     *   URI to redirect to when complete\n     *   @param {String} config.scope\n     *   OAuth scope\n     *   @param {String} config.email\n     *   Email address the user must sign in with. The user\n     *   is unable to modify the email address and is unable\n     *   to sign up if the address is not registered.\n     *   @param {String} [config.ui]\n     *   UI to present - `lightbox` or `redirect` - defaults to `redirect`\n     *   @param {Number} [options.zIndex]\n     *   only used when `config.ui=lightbox`. The zIndex of the lightbox background.\n     *   @default 100\n     *   @param {String} [options.background]\n     *   only used when `config.ui=lightbox`. The `background` CSS value\n     *   @default rgba(0,0,0,0.5)\n     */\n    forceAuth: partial(authenticate, 'forceAuth'),\n\n    /**\n     * Sign up a new user\n     *\n     * @method signUp\n     * @param {Object} config - configuration\n     *   @param {String} config.state\n     *   CSRF/State token\n     *   @param {String} config.redirectUri\n     *   URI to redirect to when complete\n     *   @param {String} config.scope\n     *   OAuth scope\n     *   @param {String} [config.email]\n     *   Email address used to pre-fill into the account form,\n     *   but the user is free to change it.\n     *   @param {String} [config.ui]\n     *   UI to present - `lightbox` or `redirect` - defaults to `redirect`\n     *   @param {Number} [options.zIndex]\n     *   only used when `config.ui=lightbox`. The zIndex of the lightbox background.\n     *   @default 100\n     *   @param {String} [options.background]\n     *   only used when `config.ui=lightbox`. The `background` CSS value\n     *   @default rgba(0,0,0,0.5)\n     */\n    signUp: partial(authenticate, 'signUp'),\n\n    /**\n     * Best choice auth strategy, has no action set.\n     * This strategy creates an oauth url to the \"/oauth\" endpoint on the content server.\n     * The oauth url has no action and the content server choose the auth flow.\n     *\n     * @method bestChoice\n     * @param {Object} config - configuration\n     *   @param {String} config.state\n     *   CSRF/State token\n     *   @param {String} config.redirectUri\n     *   URI to redirect to when complete\n     *   @param {String} config.scope\n     *   OAuth scope\n     *   @param {String} [config.email]\n     *   Email address used to pre-fill into the account form,\n     *   but the user is free to change it.\n     *   @param {String} [config.ui]\n     *   UI to present - `lightbox` or `redirect` - defaults to `redirect`\n     *   @param {Number} [options.zIndex]\n     *   only used when `config.ui=lightbox`. The zIndex of the lightbox background.\n     *   @default 100\n     *   @param {String} [options.background]\n     *   only used when `config.ui=lightbox`. The `background` CSS value\n     *   @default rgba(0,0,0,0.5)\n     */\n    bestChoice: partial(authenticate, 'bestChoice')\n  };\n\n  return AuthAPI;\n});\n\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n;(function (root, factory) {\n  // more info:\n  // https://raw.githubusercontent.com/umdjs/umd/master/returnExports.js\n  'use strict';\n  if (typeof define === 'function' && define.amd) {\n    // AMD. Register as an anonymous module.\n    define('components/micrajax/micrajax',[], factory);\n  } else if (typeof exports === 'object') {\n    // Node. Does not work with strict CommonJS, but\n    // only CommonJS-like environments that support module.exports,\n    // like Node.\n    module.exports = factory();\n  } else {\n    // Browser globals (root is window)\n    root.Micrajax = factory();\n  }\n}(this, function () {\n\n  'use strict';\n\n  var DEFAULT_CONTENT_TYPE = 'application/x-www-form-urlencoded';\n\n  function curry(fToBind) {\n    var aArgs = [].slice.call(arguments, 1);\n    var fBound = function () {\n      return fToBind.apply(null, aArgs.concat([].slice.call(arguments)));\n    };\n\n    return fBound;\n  }\n\n  function getXHRObject(options) {\n    // From http://blogs.msdn.com/b/ie/archive/2011/08/31/browsing-without-plug-ins.aspx\n    // Best Practice: Use Native XHR, if available\n    if (options.xhr) {\n      return options.xhr;\n    } else if (window.XMLHttpRequest) {\n      // If IE7+, Gecko, WebKit: Use native object\n      return new window.XMLHttpRequest();\n    } else if (window.ActiveXObject) {\n      // ...if not, try the ActiveX control\n      return new window.ActiveXObject('Microsoft.XMLHTTP');\n    }\n  }\n\n  function noOp() {}\n\n  function onReadyStateChange(xhrObject, callback) {\n    try {\n      if (xhrObject.readyState === 4) {\n        xhrObject.onreadystatechange = noOp;\n\n        callback(xhrObject.responseText, xhrObject.status, xhrObject.statusText);\n      }\n    } catch(e) {}\n  }\n\n  function toQueryParamsString(data) {\n    var queryParams = [];\n\n    for (var key in data) {\n      var value = data[key];\n\n      if (typeof value !== 'undefined') {\n        var queryParam = encodeURIComponent(key) +\n                         '=' +\n                         encodeURIComponent(value);\n        queryParams.push(queryParam);\n      }\n    }\n\n    return queryParams.join('&');\n  }\n\n\n  function setRequestHeaders(definedHeaders, xhrObject) {\n    var headers = {\n      'X-Requested-With': 'XMLHttpRequest',\n      'Accept': 'application/json;text/plain'\n    };\n\n    for (var definedHeader in definedHeaders) {\n      headers[definedHeader] = definedHeaders[definedHeader];\n    }\n\n    for (var key in headers) {\n      xhrObject.setRequestHeader(key, headers[key]);\n    }\n  }\n\n  function getURL(url, type, data) {\n    var requestString = toQueryParamsString(data);\n\n    if (type === 'GET' && requestString) {\n      url += '?' + requestString;\n    }\n\n    return url;\n  }\n\n  function getData(contentType, type, data) {\n    var sendData;\n\n    if (type !== 'GET' && data) {\n      switch (contentType) {\n        case 'application/json':\n          if (typeof data === 'string') {\n            sendData = data;\n          } else {\n            sendData = JSON.stringify(data);\n          }\n          break;\n        case 'application/x-www-form-urlencoded':\n          sendData = toQueryParamsString(data);\n          break;\n        default:\n          // do nothing\n          break;\n      }\n    }\n\n    return sendData || null;\n  }\n\n  function getHeaders(contentType, specifiedHeaders) {\n    var headers = {\n      'Content-type': contentType\n    };\n\n    for (var k in specifiedHeaders) {\n      headers[k] = specifiedHeaders[k];\n    }\n\n    return headers;\n  }\n\n  function sendRequest(options, callback, data) {\n    options = options || {};\n\n    var xhrObject = getXHRObject(options);\n\n    if (! xhrObject) {\n      throw new Error('could not get XHR object');\n    }\n\n    xhrObject.onreadystatechange = curry(onReadyStateChange, xhrObject, callback|| noOp);\n\n    var type = (options.type || 'GET').toUpperCase();\n    var contentType = options.contentType || DEFAULT_CONTENT_TYPE;\n    var url = getURL(options.url, type, options.data);\n\n    data = getData(contentType, type, options.data);\n\n    xhrObject.open(type, url, true);\n\n    var headers = getHeaders(contentType, options.headers);\n    setRequestHeaders(headers, xhrObject);\n\n    xhrObject.send(data);\n\n    return xhrObject;\n  }\n\n  var Micrajax = {\n    ajax: function (options) {\n      options = options || {};\n      var error = options.error || noOp;\n      var success = options.success || noOp;\n      var mockXHR = { readyState: 0 };\n\n      var xhrObject = sendRequest(options, function (responseText, status, statusText) {\n        mockXHR.status = status;\n        mockXHR.responseText = responseText;\n        if (! mockXHR.statusText) {\n          mockXHR.statusText = status !== 0 ? statusText : 'error';\n        }\n        mockXHR.readyState = 4;\n\n        if (status >= 200 && status < 300 || status === 304) {\n          var respData = responseText;\n\n          try {\n            // The text response could be text/plain, just ignore the JSON\n            // parse error in this case.\n            respData = JSON.parse(responseText);\n          } catch(e) {}\n\n          success(respData, responseText, mockXHR);\n        } else {\n          error(mockXHR, status, responseText);\n        }\n      });\n\n      mockXHR.abort = function () {\n        mockXHR.statusText = 'aborted';\n        xhrObject.abort();\n      };\n\n      return mockXHR;\n    }\n  };\n\n  return Micrajax;\n}));\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\ndefine('client/lib/xhr',[\n  'p-promise',\n  'components/micrajax/micrajax',\n  './function'\n], function (p, micrajax, FunctionHelpers) {\n  'use strict';\n\n  var partial = FunctionHelpers.partial;\n\n  var NodeXMLHttpRequest;\n  try {\n    // If embedded in node, use the xhr2 module\n    if (typeof require !== 'undefined') {\n      NodeXMLHttpRequest = require('xhr2');\n    }\n  } catch (e) {\n    NodeXMLHttpRequest = null;\n  }\n\n  function getXHRObject(xhr) {\n    if (xhr) {\n      return xhr;\n    } else if (NodeXMLHttpRequest) {\n      return new NodeXMLHttpRequest();\n    }\n    // fallback to the system default\n  }\n\n  /**\n   * Provides XHR functionality for use in either a browser or node\n   * environment.\n   *\n   * @class Xhr\n   * @static\n   */\n\n  function request(method, path, data, options) {\n    options = options || {};\n\n    var deferred = p.defer();\n\n    micrajax.ajax({\n      type: method,\n      url: path,\n      data: data,\n      contentType: options.contentType || 'application/json',\n      headers: options.headers,\n      xhr: getXHRObject(options.xhr),\n      success: function (data, responseText, jqXHR) {\n        deferred.resolve(data);\n      },\n      error: function (jqXHR, status, responseText) {\n        deferred.reject(responseText);\n      }\n    });\n\n    return deferred.promise;\n  }\n\n  var XHR = {\n    /**\n     * Perform a GET request\n     * @method get\n     * @param {String} path\n     * endpoint URL\n     * @param {Object || String} [data]\n     * data to send\n     * @param {Object} [options={}]\n     * Options\n     * @param {String} [options.contentType]\n     * Content type of `data`. Defaults to `application/json`\n     * @param {Object} [options.headers]\n     * Headers to pass with request.\n     * @param {Object} [options.xhr]\n     * XMLHttpRequest compatible object to use for XHR requests\n     * @return {Promise} A promise that will be fulfilled with JSON `xhr.responseText` of the request\n     */\n    get: partial(request, 'GET'),\n\n    /**\n     * Perform a POST request\n     * @method post\n     * @param {String} path\n     * endpoint URL\n     * @param {Object || String} [data]\n     * data to send\n     * @param {Object} [options={}]\n     * Options\n     * @param {String} [options.contentType]\n     * Content type of `data`. Defaults to `application/json`\n     * @param {Object} [options.headers]\n     * Headers to pass with request.\n     * @param {Object} [options.xhr]\n     * XMLHttpRequest compatible object to use for XHR requests\n     * @return {Promise} A promise that will be fulfilled with JSON `xhr.responseText` of the request\n     */\n    post: partial(request, 'POST')\n  };\n\n  return XHR;\n});\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\ndefine('client/token/api',[\n  'p-promise',\n  'client/lib/constants',\n  'client/lib/xhr'\n], function (p, Constants, Xhr) {\n  'use strict';\n\n  /**\n   * @class TokenAPI\n   * @constructor\n   * @param {string} clientId - the OAuth client ID for the relier\n   * @param {Object} [options={}] - configuration\n   *   @param {String} [options.clientSecret]\n   *   Client secret\n   *   @param {String} [options.oauthHost]\n   *   Firefox Accounts OAuth Server host\n   */\n  function TokenAPI(clientId, options) {\n    if (! clientId) {\n      throw new Error('clientId is required');\n    }\n    this._clientId = clientId;\n\n    options = options || {};\n    this._clientSecret = options.clientSecret;\n    this._oauthHost = options.oauthHost || Constants.DEFAULT_OAUTH_HOST;\n  }\n\n  TokenAPI.prototype = {\n    /**\n     * Trade an OAuth code for a longer lived OAuth token. See\n     * https://github.com/mozilla/fxa-oauth-server/blob/master/docs/api.md#post-v1token\n     *\n     * @method tradeCode\n     * @param {String} code\n     * OAuth code\n     * @returns {String}\n     * OAuth token\n     * @param {Object} [options={}] - configuration\n     *   @param {String} [options.xhr]\n     *   XMLHttpRequest compatible object to use to make the request.\n     * @returns {Promise}\n     * Response resolves to an object with `access_token`, `scope`, and\n     * `token_type`.\n     */\n    tradeCode: function (code, options) {\n      if (! this._clientSecret) {\n        return p.reject(new Error('clientSecret is required'));\n      }\n\n      if (! code) {\n        return p.reject(new Error('code is required'));\n      }\n\n      var endpoint = this._oauthHost + '/token';\n      return Xhr.post(endpoint, {\n          client_id: this._clientId,\n          client_secret: this._clientSecret,\n          code: code\n        }, options);\n    },\n\n    /**\n     * Verify an OAuth token is valid. See\n     * https://github.com/mozilla/fxa-oauth-server/blob/master/docs/api.md#post-v1verify\n     *\n     * @method verifyToken\n     * @param {String} token\n     * OAuth token to verify\n     * @param {Object} [options={}] - configuration\n     *   @param {String} [options.xhr]\n     *   XMLHttpRequest compatible object to use to make the request.\n     * @returns {Promise}\n     * Response resolves to an object with `user`, `client_id`, and\n     * `scopes`.\n     */\n    verifyToken: function (token, options) {\n      if (! token) {\n        return p.reject(new Error('token is required'));\n      }\n\n      var endpoint = this._oauthHost + '/verify';\n      return Xhr.post(endpoint, {\n          token: token\n        }, options);\n    },\n\n    /**\n     * After a client is done using a token, the responsible thing to do is to\n     * destroy the token afterwards.\n     * See https://github.com/mozilla/fxa-oauth-server/blob/master/docs/api.md#post-v1destroy\n     *\n     * @method destroyToken\n     * @param {String} token\n     * OAuth token to verify\n     * @param {Object} [options={}] - configuration\n     *   @param {String} [options.xhr]\n     *   XMLHttpRequest compatible object to use to make the request.\n     * @returns {Promise}\n     * Response resolves to an empty object.\n     */\n    destroyToken: function (token, options) {\n      if (! this._clientSecret) {\n        return p.reject(new Error('clientSecret is required'));\n      }\n\n      if (! token) {\n        return p.reject(new Error('token is required'));\n      }\n\n      var endpoint = this._oauthHost + '/destroy';\n      return Xhr.post(endpoint, {\n        client_secret: this._clientSecret,\n        token: token\n      }, options);\n    }\n  };\n\n  return TokenAPI;\n});\n\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\ndefine('client/profile/api',[\n  'p-promise',\n  'client/lib/constants',\n  'client/lib/xhr',\n  'client/lib/object'\n], function (p, Constants, Xhr, ObjectHelpers) {\n  'use strict';\n\n  /**\n   * @class ProfileAPI\n   * @constructor\n   * @param {string} clientId - the OAuth client ID for the relier\n   * @param {Object} [options={}] - configuration\n   *   @param {String} [options.profileHost]\n   *   Firefox Accounts Profile Server host\n   */\n  function ProfileAPI(clientId, options) {\n    if (! clientId) {\n      throw new Error('clientId is required');\n    }\n    this._clientId = clientId;\n\n    options = options || {};\n    this._profileHost = options.profileHost || Constants.DEFAULT_PROFILE_HOST;\n  }\n\n  ProfileAPI.prototype = {\n    /**\n     * Fetch a user's profile data.\n     *\n     * @method fetch\n     * @param {String} token\n     * Scoped OAuth token that can be used to access the profile data\n     * @param {Object} [options={}] - configuration\n     *   @param {String} [options.xhr]\n     *   XMLHttpRequest compatible object to use to make the request.\n     * @returns {Promise}\n     * Response resolves to the user's profile data on success.\n     */\n    fetch: function (token, options) {\n      if (! token) {\n        throw new Error('token is required');\n      }\n\n      var xhrOptions = ObjectHelpers.extend({\n        headers: {\n          Authorization: 'Bearer ' + token\n        }\n      }, options);\n\n      var self = this;\n      return Xhr.get(self._profileHost + '/profile', {}, xhrOptions)\n        .then(function (profileData) {\n          self._profileData = profileData;\n          return profileData;\n        });\n    },\n\n    /**\n     * Get all the user's profile data. Must be called after `fetch`\n     *\n     * @method all\n     * @returns {Object}\n     * User's profile data that was fetched using `fetch`.\n     */\n    all: function () {\n      return this._profileData;\n    }\n  };\n\n  return ProfileAPI;\n});\n\n\n\n","/* This Source Code Form is subject to the terms of the Mozilla Public\n * License, v. 2.0. If a copy of the MPL was not distributed with this\n * file, You can obtain one at http://mozilla.org/MPL/2.0/. */\n\n/**\n * The Firefox Accounts Relier Client.\n *\n * @module FxaRelierClient\n */\n\n\ndefine('client/FxaRelierClient',[\n  'client/auth/api',\n  'client/token/api',\n  'client/profile/api'\n], function (AuthAPI, TokenAPI, ProfileAPI) {\n  'use strict';\n\n  /**\n   * The entry point. Create and use an instance of the FxaRelierClient.\n   *\n   * @class FxaRelierClient (start here)\n   * @constructor\n   * @param {string} clientId - the OAuth client ID for the relier\n   * @param {Object} [options={}] - configuration\n   *   @param {String} [options.clientSecret]\n   *   Client secret. Required to use the {{#crossLink \"TokenAPI\"}}Token{{/crossLink}} API.\n   *   @param {String} [options.contentHost]\n   *   Firefox Accounts Content Server host\n   *   @param {String} [options.oauthHost]\n   *   Firefox Accounts OAuth Server host\n   *   @param {String} [options.profileHost]\n   *   Firefox Accounts Profile Server host\n   *   @param {Object} [options.window]\n   *   window override, used for unit tests\n   *   @param {Object} [options.lightbox]\n   *   lightbox override, used for unit tests\n   *   @param {Object} [options.channel]\n   *   channel override, used for unit tests\n   * @example\n   *     var fxaRelierClient = new FxaRelierClient(<client_id>);\n   */\n  function FxaRelierClient(clientId, options) {\n    if (! clientId) {\n      throw new Error('clientId is required');\n    }\n\n    /**\n     * Authenticate users in the browser. Implements {{#crossLink \"AuthAPI\"}}{{/crossLink}}.\n     * @property auth\n     * @type {Object}\n     *\n     * @example\n     *     var fxaRelierClient = new FxaRelierClient('<client_id>');\n     *     fxaRelierClient.auth.signIn({\n     *       state: <state>,\n     *       redirectUri: <redirect_uri>,\n     *       scope: 'profile'\n     *     });\n     */\n    this.auth = new AuthAPI(clientId, options);\n\n    /**\n     * Manage tokens on the server. Implements {{#crossLink \"TokenAPI\"}}{{/crossLink}}.\n     * @property token\n     * @type {Object}\n     *\n     * @example\n     *     var fxaRelierClient = new FxaRelierClient('<client_id>', {\n     *       clientSecret: <client_secret>\n     *     });\n     *     fxaRelierClient.token.tradeCode(<code>)\n     *       .then(function (token) {\n     *         // do something awesome with the token like get\n     *         // profile information. See profile.\n     *       });\n     */\n    this.token = new TokenAPI(clientId, options);\n\n    /**\n     * Fetch profile information on the server. Implements {{#crossLink \"ProfileAPI\"}}{{/crossLink}}.\n     * @property profile\n     * @type {Object}\n     *\n     * @example\n     *     var fxaRelierClient = new FxaRelierClient('<client_id>', {\n     *       clientSecret: <client_secret>\n     *     });\n     *     fxaRelierClient.token.tradeCode(<code>)\n     *       .then(function (token) {\n     *         return fxaRelierClient.fetch(token);\n     *       })\n     *       .then(function (profile) {\n     *         // display some profile info.\n     *       });\n     */\n    this.profile = new ProfileAPI(clientId, options);\n  }\n\n  FxaRelierClient.prototype = {\n    /**\n     * FxaRelierClient version\n     *\n     * @property version\n     * @type {String}\n     */\n    version: '0.0.0',\n\n    auth: null\n  };\n\n  return FxaRelierClient;\n});\n\n\n"]}